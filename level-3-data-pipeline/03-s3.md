# S3 (Simple Storage Service)

## 1. í•œ ì¤„ ìš”ì•½

ë¬´í•œíˆ í™•ì¥ ê°€ëŠ¥í•œ **ê°ì²´ ìŠ¤í† ë¦¬ì§€**ë¡œ, ë°ì´í„° íŒŒì´í”„ë¼ì¸ì—ì„œ **ë°ì´í„° ë ˆì´í¬**ì˜ í•µì‹¬ ì €ì¥ì†Œ ì—­í• ì„ í•©ë‹ˆë‹¤.

---

## 2. ì‰½ê²Œ ì„¤ëª…

### ëª¨ë°”ì¼ ê°œë°œì ê´€ì ì˜ ë¹„ìœ 

**ë¬´í•œí•œ ìš©ëŸ‰ì˜ Google Drive**ë¥¼ ìƒê°í•´ë³´ì„¸ìš”.

| ê°œë… | Google Drive | S3 |
|------|-------------|-----|
| í´ë” | í´ë” | Bucket + Prefix |
| íŒŒì¼ | ë¬¸ì„œ, ì‚¬ì§„ | Object |
| ê³µìœ  ë§í¬ | ë§í¬ ìƒì„± | Pre-signed URL |
| ìš©ëŸ‰ | 15GB ë¬´ë£Œ | ì‚¬ì‹¤ìƒ ë¬´ì œí•œ |

### ì™œ DBê°€ ì•„ë‹ˆë¼ S3ì¸ê°€?

```
âŒ ëª¨ë“  ë¡œê·¸ë¥¼ DBì— ì €ì¥í•˜ë©´...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¼ì¼ ë¡œê·¸ 5ì²œë§Œ ê±´ Ã— 1KB = 50GB/ì¼               â”‚
â”‚  ì›”ê°„ = 1.5TB                                     â”‚
â”‚  ì—°ê°„ = 18TB                                      â”‚
â”‚                                                   â”‚
â”‚  RDS ë¹„ìš©: ì•½ $3,000/ì›” (18TB)                   â”‚
â”‚  ì¿¼ë¦¬ ì„±ëŠ¥: ì ì  ëŠë ¤ì§                           â”‚
â”‚  ë°±ì—…/ë³µêµ¬: ë§¤ìš° ì–´ë ¤ì›€                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… S3ì— ì €ì¥í•˜ë©´...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë™ì¼í•œ 18TB ì €ì¥                                 â”‚
â”‚                                                   â”‚
â”‚  S3 ë¹„ìš©: ì•½ $400/ì›” (Standard)                  â”‚
â”‚  ë˜ëŠ”: ì•½ $70/ì›” (Glacier)                       â”‚
â”‚  ì¿¼ë¦¬: Athena, Trinoë¡œ ì§ì ‘ ì¡°íšŒ ê°€ëŠ¥             â”‚
â”‚  í™•ì¥: ë¬´ì œí•œ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° ë ˆì´í¬ë€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA LAKE (S3)                          â”‚
â”‚                                                              â”‚
â”‚   "ëª¨ë“  ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ ì›ë³¸ ê·¸ëŒ€ë¡œ ì €ì¥í•˜ëŠ” ê±°ëŒ€í•œ í˜¸ìˆ˜"      â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚  JSON   â”‚ â”‚ Parquet â”‚ â”‚   CSV   â”‚ â”‚  Image  â”‚          â”‚
â”‚   â”‚  Logs   â”‚ â”‚  Data   â”‚ â”‚ Export  â”‚ â”‚  Files  â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚   íŠ¹ì§•:                                                      â”‚
â”‚   â€¢ ìŠ¤í‚¤ë§ˆ ê°•ì œ ì—†ìŒ (Schema-on-Read)                        â”‚
â”‚   â€¢ ëª¨ë“  í˜•ì‹ ì €ì¥ ê°€ëŠ¥                                      â”‚
â”‚   â€¢ ë‚˜ì¤‘ì— ìš©ë„ ê²°ì • ê°€ëŠ¥                                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. êµ¬ì¡° ë‹¤ì´ì–´ê·¸ë¨

### S3 ë°ì´í„° ë ˆì´í¬ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    S3 DATA LAKE ARCHITECTURE                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  S3 BUCKET: company-data-lake                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ raw/                        â—€â”€â”€ ì›ì‹œ ë°ì´í„° (Bronze)               â”‚
â”‚  â”‚   â”œâ”€â”€ app-logs/                                                       â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ dt=2024-01-15/                                             â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ hour=00/                                               â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ events_001.json.gz                                 â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ events_002.json.gz                                 â”‚
â”‚  â”‚   â”‚   â”‚   â””â”€â”€ hour=01/                                               â”‚
â”‚  â”‚   â”‚   â””â”€â”€ dt=2024-01-16/                                             â”‚
â”‚  â”‚   â””â”€â”€ server-logs/                                                    â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â”œâ”€â”€ processed/                  â—€â”€â”€ ì •ì œ ë°ì´í„° (Silver)               â”‚
â”‚  â”‚   â”œâ”€â”€ events/                                                         â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ dt=2024-01-15/                                             â”‚
â”‚  â”‚   â”‚   â”‚   â””â”€â”€ part-00000.parquet                                     â”‚
â”‚  â”‚   â”‚   â””â”€â”€ _SUCCESS                                                    â”‚
â”‚  â”‚   â””â”€â”€ users/                                                          â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â”œâ”€â”€ curated/                    â—€â”€â”€ ë¶„ì„ìš© ë°ì´í„° (Gold)               â”‚
â”‚  â”‚   â”œâ”€â”€ daily_metrics/                                                  â”‚
â”‚  â”‚   â””â”€â”€ user_segments/                                                  â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â””â”€â”€ archive/                    â—€â”€â”€ ì•„ì¹´ì´ë¸Œ (Glacier)                 â”‚
â”‚      â””â”€â”€ 2023/                                                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íŒŒí‹°ì…”ë‹ ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PARTITIONING STRATEGIES                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ë‚ ì§œ ê¸°ë°˜ íŒŒí‹°ì…”ë‹ (ê°€ì¥ ì¼ë°˜ì )

   s3://bucket/logs/dt=2024-01-15/hour=10/

   ì¥ì : ì‹œê°„ ë²”ìœ„ ì¿¼ë¦¬ íš¨ìœ¨ì 
   ë‹¨ì : Hot partition ë¬¸ì œ (ìµœì‹  ë°ì´í„°ì— ì§‘ì¤‘)


2. Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…”ë‹

   s3://bucket/logs/year=2024/month=01/day=15/

   ì¥ì : ë‹¤ì–‘í•œ ë„êµ¬ í˜¸í™˜
   ë‹¨ì : ê²½ë¡œê°€ ê¸¸ì–´ì§


3. ë³µí•© íŒŒí‹°ì…”ë‹

   s3://bucket/logs/region=kr/dt=2024-01-15/event_type=purchase/

   ì¥ì : ë‹¤ì°¨ì› í•„í„°ë§ ê°€ëŠ¥
   ë‹¨ì : íŒŒí‹°ì…˜ í­ë°œ ì£¼ì˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  íŒŒí‹°ì…˜ ì„¤ê³„ ì‹œ ì£¼ì˜ì‚¬í•­                                      â”‚
â”‚                                                                   â”‚
â”‚  â€¢ íŒŒí‹°ì…˜ë‹¹ íŒŒì¼ ìˆ˜: ìˆ˜ì²œ ê°œ ì´í•˜ ê¶Œì¥                            â”‚
â”‚  â€¢ íŒŒì¼ í¬ê¸°: 128MB ~ 1GB ê¶Œì¥                                    â”‚
â”‚  â€¢ ë„ˆë¬´ ë§ì€ ì‘ì€ íŒŒì¼ = "Small File Problem"                     â”‚
â”‚  â€¢ ë„ˆë¬´ ì ì€ í° íŒŒì¼ = ë³‘ë ¬ ì²˜ë¦¬ ì–´ë ¤ì›€                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     S3 STORAGE CLASSES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ì•¡ì„¸ìŠ¤ ë¹ˆë„                                                             â”‚
â”‚       â–²                                                                  â”‚
â”‚  ë†’ìŒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚       â”‚  â”‚   S3 Standard   â”‚  $0.023/GB  ì‹¤ì‹œê°„ ì ‘ê·¼                    â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚       â”‚           â”‚                                                      â”‚
â”‚       â”‚           â–¼                                                      â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚       â”‚  â”‚ S3 Standard-IA  â”‚  $0.0125/GB  ì›” 1íšŒ ì ‘ê·¼                   â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚       â”‚           â”‚                                                      â”‚
â”‚       â”‚           â–¼                                                      â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚       â”‚  â”‚  S3 Glacier IR  â”‚  $0.004/GB  ë¶„ê¸° 1íšŒ ì ‘ê·¼                  â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚       â”‚           â”‚                                                      â”‚
â”‚       â”‚           â–¼                                                      â”‚
â”‚  ë‚®ìŒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚       â”‚  â”‚ Glacier Deep    â”‚  $0.00099/GB  ì—° 1íšŒ ì ‘ê·¼                  â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                      â”‚
â”‚                                            ë³µêµ¬ ì‹œê°„ (ë¶„ â†’ ì‹œê°„)         â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ì‹¤ë¬´ ì ìš© ì˜ˆì‹œ

### 4.1 S3 ë²„í‚· ì •ì±… ì„¤ì •

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DataTeamReadAccess",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::123456789:role/DataEngineerRole"
            },
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::company-data-lake",
                "arn:aws:s3:::company-data-lake/*"
            ]
        },
        {
            "Sid": "DenyUnencryptedUploads",
            "Effect": "Deny",
            "Principal": "*",
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::company-data-lake/*",
            "Condition": {
                "Null": {
                    "s3:x-amz-server-side-encryption": "true"
                }
            }
        }
    ]
}
```

### 4.2 ë¼ì´í”„ì‚¬ì´í´ ê·œì¹™ ì„¤ì •

```json
{
    "Rules": [
        {
            "ID": "ArchiveOldRawLogs",
            "Status": "Enabled",
            "Filter": {
                "Prefix": "raw/"
            },
            "Transitions": [
                {
                    "Days": 30,
                    "StorageClass": "STANDARD_IA"
                },
                {
                    "Days": 90,
                    "StorageClass": "GLACIER"
                }
            ],
            "Expiration": {
                "Days": 365
            }
        },
        {
            "ID": "KeepProcessedLonger",
            "Status": "Enabled",
            "Filter": {
                "Prefix": "processed/"
            },
            "Transitions": [
                {
                    "Days": 180,
                    "StorageClass": "STANDARD_IA"
                }
            ]
        }
    ]
}
```

### 4.3 Pythonìœ¼ë¡œ S3 ë°ì´í„° ì²˜ë¦¬

```python
import boto3
import pandas as pd
from io import BytesIO
import pyarrow.parquet as pq

# S3 í´ë¼ì´ì–¸íŠ¸ ìƒì„±
s3 = boto3.client('s3')
BUCKET_NAME = 'company-data-lake'

def list_partitions(prefix: str, date: str) -> list:
    """íŠ¹ì • ë‚ ì§œì˜ íŒŒí‹°ì…˜ ëª©ë¡ ì¡°íšŒ"""
    response = s3.list_objects_v2(
        Bucket=BUCKET_NAME,
        Prefix=f"{prefix}/dt={date}/",
        Delimiter='/'
    )
    return [p['Prefix'] for p in response.get('CommonPrefixes', [])]


def read_parquet_from_s3(key: str) -> pd.DataFrame:
    """S3ì—ì„œ Parquet íŒŒì¼ ì½ê¸°"""
    response = s3.get_object(Bucket=BUCKET_NAME, Key=key)
    return pd.read_parquet(BytesIO(response['Body'].read()))


def write_parquet_to_s3(df: pd.DataFrame, key: str):
    """DataFrameì„ S3ì— Parquetìœ¼ë¡œ ì €ì¥"""
    buffer = BytesIO()
    df.to_parquet(buffer, engine='pyarrow', compression='snappy')
    buffer.seek(0)

    s3.put_object(
        Bucket=BUCKET_NAME,
        Key=key,
        Body=buffer.getvalue(),
        ContentType='application/octet-stream'
    )


def generate_presigned_url(key: str, expiration: int = 3600) -> str:
    """íŒŒì¼ ë‹¤ìš´ë¡œë“œìš© ì„ì‹œ URL ìƒì„±"""
    return s3.generate_presigned_url(
        'get_object',
        Params={'Bucket': BUCKET_NAME, 'Key': key},
        ExpiresIn=expiration
    )


# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == '__main__':
    # 1. íŒŒí‹°ì…˜ ì¡°íšŒ
    partitions = list_partitions('raw/app-logs', '2024-01-15')
    print(f"Found {len(partitions)} partitions")

    # 2. ë°ì´í„° ì½ê¸°
    df = read_parquet_from_s3('processed/events/dt=2024-01-15/part-00000.parquet')
    print(f"Loaded {len(df)} rows")

    # 3. ì²˜ë¦¬ í›„ ì €ì¥
    aggregated = df.groupby('event_name').size().reset_index(name='count')
    write_parquet_to_s3(aggregated, 'curated/daily_metrics/dt=2024-01-15/metrics.parquet')
```

### 4.4 íŒŒì¼ í¬ë§· ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FILE FORMAT COMPARISON                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Format  â”‚  JSON    â”‚   CSV    â”‚ Parquet  â”‚   ORC    â”‚               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚  â”‚ íƒ€ì…    â”‚  í–‰ ê¸°ë°˜  â”‚  í–‰ ê¸°ë°˜  â”‚  ì—´ ê¸°ë°˜  â”‚  ì—´ ê¸°ë°˜  â”‚               â”‚
â”‚  â”‚ ì••ì¶•    â”‚  ë‚®ìŒ    â”‚  ë‚®ìŒ    â”‚  ë†’ìŒ    â”‚  ë†’ìŒ    â”‚               â”‚
â”‚  â”‚ ìŠ¤í‚¤ë§ˆ  â”‚  ì—†ìŒ    â”‚  ì—†ìŒ    â”‚  ìˆìŒ    â”‚  ìˆìŒ    â”‚               â”‚
â”‚  â”‚ ì¿¼ë¦¬    â”‚  ì „ì²´ìŠ¤ìº” â”‚  ì „ì²´ìŠ¤ìº” â”‚ ì»¬ëŸ¼ í‘¸ì‹œë‹¤ìš´â”‚ì»¬ëŸ¼ í‘¸ì‹œë‹¤ìš´â”‚               â”‚
â”‚  â”‚ ìš©ë„    â”‚  ì›ì‹œë¡œê·¸ â”‚  Export  â”‚  ë¶„ì„ìš©  â”‚  Hiveìš©  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â”‚  ğŸ’¡ ê¶Œì¥:                                                                â”‚
â”‚  â€¢ ì›ì‹œ ë°ì´í„°: JSON (ìœ ì—°ì„±)                                            â”‚
â”‚  â€¢ ë¶„ì„ìš© ë°ì´í„°: Parquet (ì„±ëŠ¥)                                         â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ì¥ë‹¨ì 

### S3ì˜ ì¥ì 

| ì¥ì  | ì„¤ëª… |
|------|------|
| **ë¬´í•œ í™•ì¥** | ìš©ëŸ‰ ì œí•œ ì—†ìŒ, ìë™ í™•ì¥ |
| **ê³ ê°€ìš©ì„±** | 99.999999999% (11 nines) ë‚´êµ¬ì„± |
| **ì €ë ´í•œ ë¹„ìš©** | GBë‹¹ $0.023, ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ë¡œ ì¶”ê°€ ì ˆê° |
| **ìœ ì—°í•œ ì ‘ê·¼** | API, SDK, CLI, ì½˜ì†” ë“± ë‹¤ì–‘í•œ ë°©ë²• |
| **í†µí•©** | AWS ì„œë¹„ìŠ¤ë“¤ê³¼ ë„¤ì´í‹°ë¸Œ ì—°ë™ |
| **ë²„ì „ ê´€ë¦¬** | íŒŒì¼ ë²„ì „ íˆìŠ¤í† ë¦¬ ìœ ì§€ ê°€ëŠ¥ |

### S3ì˜ ë‹¨ì 

| ë‹¨ì  | ì„¤ëª… |
|------|------|
| **ì§€ì—° ì‹œê°„** | ì‹¤ì‹œê°„ DB ëŒ€ë¹„ ëŠë¦¼ (ë°€ë¦¬ì´ˆ â†’ ì´ˆ) |
| **ì¼ê´€ì„±** | ìµœì¢… ì¼ê´€ì„± (eventual consistency) |
| **íŠ¸ëœì­ì…˜ ì—†ìŒ** | ACID ë¯¸ì§€ì› |
| **ì¿¼ë¦¬ ì œí•œ** | ì§ì ‘ SQL ë¶ˆê°€ (Athena í•„ìš”) |
| **ë¹„ìš© ì˜ˆì¸¡** | ìš”ì²­ ìˆ˜ì— ë”°ë¥¸ ì¶”ê°€ ë¹„ìš© |

---

## 6. ë‚´ ìƒê°

```
(í•™ìŠµ í›„ ìì‹ ì˜ ìƒê°ì„ ì •ë¦¬í•´ë³´ì„¸ìš”)

- í˜„ì¬ ìš°ë¦¬ ì„œë¹„ìŠ¤ì˜ ë°ì´í„°ëŠ” ì–´ë””ì— ì €ì¥ë˜ì–´ ìˆëŠ”ê°€?

- S3ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ ì˜ˆìƒë˜ëŠ” ì´ì ì€?

- íŒŒí‹°ì…”ë‹ ì „ëµì€ ì–´ë–»ê²Œ ê°€ì ¸ê°ˆ ê²ƒì¸ê°€?

```

---

## 7. ì¶”ê°€ ì§ˆë¬¸

### ê¸°ì´ˆ ë ˆë²¨
1. S3ì˜ "ê°ì²´ ìŠ¤í† ë¦¬ì§€"ì™€ ì¼ë°˜ íŒŒì¼ì‹œìŠ¤í…œì˜ ì°¨ì´ì ì€?

> **ë‹µë³€**: **íŒŒì¼ì‹œìŠ¤í…œ**ì€ ê³„ì¸µì  ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê³ , íŒŒì¼ ì¼ë¶€ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì´ì–´ì“°ê¸°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë°˜ë©´ **ê°ì²´ ìŠ¤í† ë¦¬ì§€(S3)**ëŠ” í‰ë©´(flat) êµ¬ì¡°ë¡œ ê° ê°ì²´ê°€ ê³ ìœ  í‚¤ë¥¼ ê°€ì§€ë©°, ê°ì²´ ì „ì²´ë¥¼ ë®ì–´ì“°ê¸°ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. **ì£¼ìš” ì°¨ì´ì **: (1) **êµ¬ì¡°**: íŒŒì¼ì‹œìŠ¤í…œì€ í´ë”/ì„œë¸Œí´ë”, S3ëŠ” ë²„í‚·/í”„ë¦¬í”½ìŠ¤(ìŠ¬ë˜ì‹œë¡œ êµ¬ë¶„ëœ í‚¤). S3ì—ì„œ `logs/2024/01/file.json`ì€ ì‹¤ì œ í´ë”ê°€ ì•„ë‹Œ ê·¸ëƒ¥ ê¸´ í‚¤ì…ë‹ˆë‹¤. (2) **ìˆ˜ì •**: íŒŒì¼ì‹œìŠ¤í…œì€ ì¼ë¶€ ìˆ˜ì • ê°€ëŠ¥, S3ëŠ” ì „ì²´ ì¬ì—…ë¡œë“œë§Œ ê°€ëŠ¥. (3) **ë©”íƒ€ë°ì´í„°**: S3ëŠ” ê° ê°ì²´ì— ì‚¬ìš©ì ì •ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ í’ë¶€í•˜ê²Œ ì €ì¥ ê°€ëŠ¥. (4) **í™•ì¥ì„±**: S3ëŠ” ë¬´í•œ í™•ì¥, íŒŒì¼ì‹œìŠ¤í…œì€ ë””ìŠ¤í¬ ìš©ëŸ‰ ì œí•œ. (5) **ì ‘ê·¼ë°©ì‹**: íŒŒì¼ì‹œìŠ¤í…œì€ ë§ˆìš´íŠ¸ í›„ ê²½ë¡œ ì ‘ê·¼, S3ëŠ” HTTP REST APIë¡œ ì ‘ê·¼. ëª¨ë°”ì¼ ê°œë°œìì—ê²Œ ë¹„ìœ í•˜ìë©´, íŒŒì¼ì‹œìŠ¤í…œì€ ê¸°ê¸° ë‚´ ë¡œì»¬ ì €ì¥ì†Œ(Documents í´ë”), S3ëŠ” Firebase Storage ê°™ì€ í´ë¼ìš°ë“œ ì €ì¥ì†Œì…ë‹ˆë‹¤.

2. S3 ë²„í‚· ë„¤ì´ë° ê·œì¹™ê³¼ ë¦¬ì „ ì„ íƒ ì‹œ ê³ ë ¤ì‚¬í•­ì€?

> **ë‹µë³€**: **ë²„í‚· ë„¤ì´ë° ê·œì¹™**: (1) ì „ì„¸ê³„ì ìœ¼ë¡œ ê³ ìœ í•´ì•¼ í•¨ (ë‹¤ë¥¸ AWS ê³„ì •ê³¼ë„ ì¤‘ë³µ ë¶ˆê°€), (2) 3~63ì, ì†Œë¬¸ì/ìˆ«ì/í•˜ì´í”ˆë§Œ í—ˆìš©, (3) ìˆ«ìë‚˜ í•˜ì´í”ˆìœ¼ë¡œ ì‹œì‘/ë ë¶ˆê°€, (4) IP ì£¼ì†Œ í˜•ì‹ ë¶ˆê°€. ê¶Œì¥ íŒ¨í„´: `company-project-environment-purpose` (ì˜ˆ: `mycompany-analytics-prod-datalake`). **ë¦¬ì „ ì„ íƒ ê³ ë ¤ì‚¬í•­**: (1) **ì§€ì—°ì‹œê°„**: ë°ì´í„° ì†ŒìŠ¤(ì•± ì„œë²„)ì™€ ê°€ê¹Œìš´ ë¦¬ì „ ì„ íƒ. í•œêµ­ ì„œë¹„ìŠ¤ë¼ë©´ `ap-northeast-2(ì„œìš¸)`. (2) **ë¹„ìš©**: ë¦¬ì „ë³„ ìš”ê¸ˆ ì°¨ì´ ì¡´ì¬. ë¯¸êµ­ ë¦¬ì „ì´ ë³´í†µ ì €ë ´. (3) **ê·œì •ì¤€ìˆ˜**: GDPR(ìœ ëŸ½ ë°ì´í„°ëŠ” EU ë¦¬ì „), ê°œì¸ì •ë³´ë³´í˜¸ë²•(í•œêµ­ ë°ì´í„°ëŠ” êµ­ë‚´ ë¦¬ì „) ë“±. (4) **ì„œë¹„ìŠ¤ ê°€ìš©ì„±**: ì¼ë¶€ AWS ì„œë¹„ìŠ¤ëŠ” íŠ¹ì • ë¦¬ì „ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥. (5) **ì¬í•´ë³µêµ¬**: Cross-Region Replication ì„¤ì • ì‹œ ë‹¤ë¥¸ ë¦¬ì „ ì„ íƒ. ì‹¤ë¬´ì—ì„œëŠ” Spark/EMR í´ëŸ¬ìŠ¤í„°ì™€ ê°™ì€ ë¦¬ì „ì— S3 ë²„í‚·ì„ ë‘ì–´ ë°ì´í„° ì „ì†¡ ë¹„ìš©ê³¼ ì§€ì—°ì„ ì¤„ì…ë‹ˆë‹¤.

3. Pre-signed URLì€ ì–¸ì œ, ì™œ ì‚¬ìš©í•˜ë‚˜ìš”?

> **ë‹µë³€**: **Pre-signed URL**ì€ ì¼ì‹œì ìœ¼ë¡œ S3 ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ í¬í•¨ëœ ì„œëª…ëœ URLì…ë‹ˆë‹¤. **ì‚¬ìš© ì‹œê¸°**: (1) **íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê³µìœ **: ë¹„ê³µê°œ S3 ê°ì²´ë¥¼ íŠ¹ì • ì‚¬ìš©ìì—ê²Œ ì„ì‹œë¡œ ê³µìœ í•  ë•Œ. ì˜ˆ: ëª¨ë°”ì¼ ì•±ì—ì„œ ì‚¬ìš©ìì˜ ì˜ìˆ˜ì¦ PDF ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ. (2) **ì§ì ‘ ì—…ë¡œë“œ**: ì„œë²„ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  í´ë¼ì´ì–¸íŠ¸ê°€ S3ì— ì§ì ‘ ì—…ë¡œë“œí•  ë•Œ. ì˜ˆ: ëª¨ë°”ì¼ ì•±ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°±ì—”ë“œ ê²½ìœ  ì—†ì´ S3ì— ì§ì ‘ ì—…ë¡œë“œ. (3) **CDN ìš°íšŒ**: CloudFront ì—†ì´ ì„ì‹œ ë‹¤ìš´ë¡œë“œ ë§í¬ê°€ í•„ìš”í•  ë•Œ. **ë³´ì•ˆ ì¥ì **: (1) AWS ìê²©ì¦ëª…ì„ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œí•˜ì§€ ì•ŠìŒ, (2) ë§Œë£Œ ì‹œê°„ì„ ì„¤ì •í•˜ì—¬ ì˜êµ¬ ì ‘ê·¼ ë°©ì§€ (ë³´í†µ 1ì‹œê°„~24ì‹œê°„), (3) íŠ¹ì • IP, HTTP ë©”ì„œë“œë¡œ ì œí•œ ê°€ëŠ¥. ëª¨ë°”ì¼ ì•±ì—ì„œ ëŒ€ìš©ëŸ‰ íŒŒì¼(ë™ì˜ìƒ, ì´ë¯¸ì§€) ì—…ë¡œë“œ ì‹œ Pre-signed URLë¡œ S3 ì§ì ‘ ì—…ë¡œë“œí•˜ë©´ ì„œë²„ ë¶€í•˜ì™€ ë¹„ìš©ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‹¬í™” ë ˆë²¨
4. S3 Selectì™€ Athenaì˜ ì°¨ì´ì ê³¼ ì‚¬ìš© ì‚¬ë¡€ëŠ”?

> **ë‹µë³€**: ë‘˜ ë‹¤ S3 ë°ì´í„°ë¥¼ SQLë¡œ ì¡°íšŒí•˜ì§€ë§Œ ìš©ë„ê°€ ë‹¤ë¦…ë‹ˆë‹¤. **S3 Select**: ë‹¨ì¼ ê°ì²´ ë‚´ì—ì„œ íŠ¹ì • í–‰/ì»¬ëŸ¼ë§Œ ì¶”ì¶œí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 100MB JSON íŒŒì¼ì—ì„œ íŠ¹ì • í•„ë“œë§Œ í•„ìš”í•  ë•Œ, ì „ì²´ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì§€ ì•Šê³  í•„ìš”í•œ ë¶€ë¶„ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤. ìŠ¤ìº” ë°ì´í„° ê¸°ì¤€ ê³¼ê¸ˆ($0.002/GB). **Athena**: ì—¬ëŸ¬ ê°ì²´ì— ê±¸ì³ ë³µì¡í•œ SQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ ì¿¼ë¦¬ ì—”ì§„ì…ë‹ˆë‹¤. JOIN, GROUP BY, ìœˆë„ìš° í•¨ìˆ˜ ë“± ì§€ì›. ìŠ¤ìº” ë°ì´í„° ê¸°ì¤€ ê³¼ê¸ˆ($5/TB). **ì‚¬ìš© ì‚¬ë¡€ ë¹„êµ**: S3 SelectëŠ” "ì´ íŒŒì¼ì—ì„œ user_id=123ì¸ í–‰ë§Œ ê°€ì ¸ì™€"ì²˜ëŸ¼ ë‹¨ìˆœ í•„í„°ë§ì— ì í•©. AthenaëŠ” "ì§€ë‚œ 7ì¼ê°„ ì¼ë³„ ë§¤ì¶œ ì§‘ê³„"ì²˜ëŸ¼ ë¶„ì„ ì¿¼ë¦¬ì— ì í•©. **ì‹¤ë¬´ íŒ**: Lambdaì—ì„œ S3 Selectë¡œ ë¹ ë¥´ê²Œ ë°ì´í„° ì¶”ì¶œ, ë¶„ì„ê°€ëŠ” Athenaë¡œ Ad-hoc ì¿¼ë¦¬ ì‹¤í–‰í•˜ëŠ” ì‹ìœ¼ë¡œ ì—­í• ì„ ë¶„ë‹´í•©ë‹ˆë‹¤.

5. Cross-region replicationì€ ì–¸ì œ í•„ìš”í•œê°€ìš”?

> **ë‹µë³€**: **Cross-Region Replication(CRR)**ì€ S3 ê°ì²´ë¥¼ ë‹¤ë¥¸ ë¦¬ì „ì˜ ë²„í‚·ìœ¼ë¡œ ìë™ ë³µì œí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. **í•„ìš”í•œ ìƒí™©**: (1) **ì¬í•´ë³µêµ¬(DR)**: í•œ ë¦¬ì „ì´ ì™„ì „íˆ ì¥ì• ê°€ ë‚˜ë„ ë‹¤ë¥¸ ë¦¬ì „ì—ì„œ ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥. ê¸ˆìœµ, ì˜ë£Œ ë“± ê·œì œ ì‚°ì—…ì—ì„œ í•„ìˆ˜. (2) **ì§€ì—°ì‹œê°„ ìµœì†Œí™”**: ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ìì™€ ê°€ê¹Œìš´ ë¦¬ì „ì— ë°ì´í„° ë³µì œ. ì˜ˆ: ì„œìš¸ ì›ë³¸ â†’ ë¯¸êµ­/ìœ ëŸ½ ë³µì œ. (3) **ê·œì •ì¤€ìˆ˜**: íŠ¹ì • êµ­ê°€ì— ë°ì´í„° ì‚¬ë³¸ì„ ìœ ì§€í•´ì•¼ í•˜ëŠ” ë²•ì  ìš”êµ¬ì‚¬í•­. (4) **ë°ì´í„° ì´ê´€**: ë¦¬ì „ ê°„ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜. **ë¹„ìš© ê³ ë ¤ì‚¬í•­**: ë³µì œëœ ìŠ¤í† ë¦¬ì§€ ë¹„ìš© + ë¦¬ì „ ê°„ ë°ì´í„° ì „ì†¡ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤. ë™ì¼ ë¦¬ì „ ë‚´ ë³µì œ(Same-Region Replication)ëŠ” ì „ì†¡ ë¹„ìš© ì—†ì´ ë²„ì „ ê´€ë¦¬, ë¡œê·¸ ì§‘ê³„ ë“±ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ëª¨ë°”ì¼ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì£¼ë¡œ DR ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©°, ì›” 1íšŒ ì •ë„ ë³µì œ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

6. S3 Event Notificationì„ í™œìš©í•œ ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ëŠ”?

> **ë‹µë³€**: **S3 Event Notification**ì€ ê°ì²´ ìƒì„±/ì‚­ì œ ì‹œ ìë™ìœ¼ë¡œ Lambda, SQS, SNSë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. **ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ ì˜ˆì‹œ**: (1) **ì‹¤ì‹œê°„ ETL**: ìƒˆ ë¡œê·¸ íŒŒì¼ì´ S3ì— ì—…ë¡œë“œë˜ë©´ â†’ Lambda íŠ¸ë¦¬ê±° â†’ Parquet ë³€í™˜ í›„ ë‹¤ë¥¸ ë²„í‚·ì— ì €ì¥. (2) **ì´ë¯¸ì§€ ì²˜ë¦¬**: ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ Lambda íŠ¸ë¦¬ê±° â†’ ì¸ë„¤ì¼ ìƒì„±, ë©”íƒ€ë°ì´í„° ì¶”ì¶œ. (3) **ì•Œë¦¼ íŒŒì´í”„ë¼ì¸**: ì—ëŸ¬ ë¡œê·¸ íŒŒì¼ ì—…ë¡œë“œ â†’ SNS íŠ¸ë¦¬ê±° â†’ Slack ì•Œë¦¼. **êµ¬í˜„ ì˜ˆì‹œ íë¦„**:
> ```
> ëª¨ë°”ì¼ ì•± â†’ API Gateway â†’ Lambda â†’ S3 (ì›ë³¸ ì´ë¯¸ì§€)
>                                      â†“ Event Notification
>                               Lambda (ë¦¬ì‚¬ì´ì§•)
>                                      â†“
>                               S3 (ì¸ë„¤ì¼)
>                                      â†“
>                               CloudFront â†’ ì•±ì—ì„œ í‘œì‹œ
> ```
> **ì£¼ì˜ì‚¬í•­**: Lambda í˜¸ì¶œ í•œë„, ë™ì¼ ë²„í‚· ë£¨í”„ ë°©ì§€(ì›ë³¸/ê²°ê³¼ ë²„í‚· ë¶„ë¦¬), ìˆœì„œ ë³´ì¥ì´ í•„ìš”í•˜ë©´ SQS FIFO ì‚¬ìš©. ì´ íŒ¨í„´ìœ¼ë¡œ ì„œë²„ ì—†ì´ í™•ì¥ ê°€ëŠ¥í•œ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤
7. ì‘ì€ íŒŒì¼ì´ ë„ˆë¬´ ë§ì•„ì¡Œì„ ë•Œ ì–´ë–»ê²Œ í•´ê²°í•˜ë‚˜ìš”?

> **ë‹µë³€**: **Small File Problem**ì€ ë°ì´í„° ë ˆì´í¬ì—ì„œ í”í•œ ë¬¸ì œë¡œ, ìˆ˜ë°±ë§Œ ê°œì˜ ì‘ì€ íŒŒì¼(KB ë‹¨ìœ„)ì´ ìŒ“ì´ë©´ ì„±ëŠ¥ì´ ì‹¬ê°í•˜ê²Œ ì €í•˜ë©ë‹ˆë‹¤. **ë¬¸ì œì **: (1) S3 LIST ìš”ì²­ ì§€ì—° ë° ë¹„ìš© ì¦ê°€, (2) Spark/Athenaì—ì„œ íŒŒì¼ë‹¹ ì˜¤ë²„í—¤ë“œë¡œ ì¿¼ë¦¬ ëŠë ¤ì§, (3) ë©”ëª¨ë¦¬ ë¶€ì¡±. **í•´ê²°ì±…**: **(1) Compaction ì‘ì—…**: ì •ê¸°ì ìœ¼ë¡œ ì‘ì€ íŒŒì¼ë“¤ì„ í° íŒŒì¼ë¡œ ë³‘í•©. Sparkì—ì„œ `coalesce()` ë˜ëŠ” `repartition()` ì‚¬ìš©.
> ```python
> df = spark.read.parquet("s3://bucket/small-files/")
> df.coalesce(10).write.parquet("s3://bucket/compacted/")  # 10ê°œ íŒŒì¼ë¡œ ë³‘í•©
> ```
> **(2) íŒŒí‹°ì…˜ ì„¤ê³„ ê°œì„ **: ë„ˆë¬´ ì„¸ë¶„í™”ëœ íŒŒí‹°ì…˜(ì˜ˆ: ë¶„ ë‹¨ìœ„) ëŒ€ì‹  ì‹œê°„/ì¼ ë‹¨ìœ„ë¡œ ë³€ê²½. **(3) Delta Lake/Iceberg ì‚¬ìš©**: ìë™ compaction ê¸°ëŠ¥ ì œê³µ. **(4) ì—…ìŠ¤íŠ¸ë¦¼ ì¡°ì •**: Kafka Consumerì—ì„œ ë” í° ë°°ì¹˜ë¡œ íŒŒì¼ ìƒì„±. **ê¶Œì¥ íŒŒì¼ í¬ê¸°**: 128MB~1GB ì‚¬ì´. íŒŒì¼ì´ ì‘ìœ¼ë©´ ë³‘í•©, ë„ˆë¬´ í¬ë©´ ë¶„í• í•©ë‹ˆë‹¤.

8. S3 ë¹„ìš©ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ìµœì í™”í•˜ëŠ” ë°©ë²•ì€?

> **ë‹µë³€**: S3 ë¹„ìš©ì€ **ìŠ¤í† ë¦¬ì§€ + ìš”ì²­ + ë°ì´í„° ì „ì†¡**ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. **ëª¨ë‹ˆí„°ë§ ë°©ë²•**: (1) **AWS Cost Explorer**: S3 ë¹„ìš©ì„ ë²„í‚·ë³„, ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ë³„ë¡œ ë¶„ì„. (2) **S3 Storage Lens**: ë²„í‚·ë³„ ì‚¬ìš©ëŸ‰, í™œë™ ì§€í‘œ ëŒ€ì‹œë³´ë“œ. ë¬´ë£Œ ê¸°ë³¸ ì§€í‘œ + ìœ ë£Œ ê³ ê¸‰ ì§€í‘œ. (3) **CloudWatch ì•Œë¦¼**: ì¼ì¼ ë¹„ìš©ì´ ì„ê³„ì¹˜ë¥¼ ë„˜ìœ¼ë©´ ì•Œë¦¼. **ìµœì í™” ë°©ë²•**: **(1) ë¼ì´í”„ì‚¬ì´í´ ì •ì±…**: 30ì¼ í›„ Standard-IA, 90ì¼ í›„ Glacierë¡œ ìë™ ì „í™˜. 1ë…„ í›„ ì‚­ì œ.
> ```json
> {"Rules": [{"ID": "ArchiveOldData", "Status": "Enabled",
>   "Transitions": [{"Days": 30, "StorageClass": "STANDARD_IA"}]}]}
> ```
> **(2) Intelligent-Tiering**: ì ‘ê·¼ íŒ¨í„´ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ ìµœì  í´ë˜ìŠ¤ ì´ë™. **(3) Requester Pays**: ë‹¤ë¥¸ ê³„ì •ì´ ë°ì´í„°ë¥¼ ë§ì´ ì½ìœ¼ë©´ ìš”ì²­ìê°€ ë¹„ìš© ë¶€ë‹´. **(4) ë¶ˆí•„ìš”í•œ ë²„ì „ ì‚­ì œ**: ë²„ì „ ê´€ë¦¬ë¡œ ìŒ“ì¸ ì´ì „ ë²„ì „ ì •ë¦¬. **(5) ì••ì¶•**: JSON ëŒ€ì‹  Parquet(70% ì ˆê°), gzip ì••ì¶• ì ìš©. ì‹¤ë¬´ì—ì„œëŠ” ì›”ì´ˆì— ì „ì›” S3 ë¹„ìš©ì„ ë¦¬ë·°í•˜ê³ , ê¸‰ì¦í•œ ë²„í‚·ì„ ë¶„ì„í•˜ëŠ” ë£¨í‹´ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

9. ì‹¤ìˆ˜ë¡œ ë°ì´í„°ë¥¼ ì‚­ì œí–ˆì„ ë•Œ ë³µêµ¬ ë°©ë²•ì€?

> **ë‹µë³€**: S3 ë°ì´í„° ë³µêµ¬ëŠ” **ì‚¬ì „ ì„¤ì • ì—¬ë¶€**ì— ë”°ë¼ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. **ë²„ì „ ê´€ë¦¬(Versioning)ê°€ ì¼œì ¸ ìˆëŠ” ê²½ìš°**: (1) ì‚­ì œëœ ê°ì²´ì—ëŠ” "Delete Marker"ë§Œ ì¶”ê°€ë˜ê³  ì´ì „ ë²„ì „ì€ ë‚¨ì•„ìˆìŒ. (2) AWS ì½˜ì†”ì—ì„œ "ë²„ì „ í‘œì‹œ"ë¥¼ ì¼œê³  ì´ì „ ë²„ì „ì„ ë³µì›í•˜ê±°ë‚˜, Delete Markerë¥¼ ì‚­ì œ. (3) CLI: `aws s3api list-object-versions --bucket my-bucket --prefix path/`ë¡œ ë²„ì „ í™•ì¸ í›„ ë³µì›. **ë²„ì „ ê´€ë¦¬ê°€ êº¼ì ¸ ìˆëŠ” ê²½ìš°**: (1) ë³µêµ¬ ë¶ˆê°€ëŠ¥. ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë¨. (2) Cross-Region Replicationì´ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ë³µì œë³¸ì—ì„œ ë³µêµ¬ ê°€ëŠ¥. **ì˜ˆë°© ì¡°ì¹˜**: (1) **Versioning í•„ìˆ˜ í™œì„±í™”**: íŠ¹íˆ ì¤‘ìš”í•œ ë°ì´í„° ë²„í‚·. (2) **MFA Delete**: ì‚­ì œ ì‹œ MFA ì¸ì¦ ìš”êµ¬ë¡œ ì‹¤ìˆ˜ ë°©ì§€. (3) **Object Lock**: ì¼ì • ê¸°ê°„ ì‚­ì œ/ìˆ˜ì • ë¶ˆê°€ ì„¤ì •(WORM). (4) **Cross-Region Replication**: ë‹¤ë¥¸ ë¦¬ì „ì— ë°±ì—… ë³µì œ. ë°ì´í„° ë ˆì´í¬ ë²„í‚·ì€ ë°˜ë“œì‹œ Versioningì„ ì¼œê³ , 90ì¼ í›„ ì´ì „ ë²„ì „ ìë™ ì‚­ì œí•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ì„ ì„¤ì •í•˜ì„¸ìš”.

---

## 8. ëª¨ë°”ì¼ ì•± ë°ì´í„°ì˜ S3 ì €ì¥ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ëª¨ë°”ì¼ ì•± ë¡œê·¸ì˜ S3 Data Lake êµ¬ì¡°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  S3 Bucket: company-mobile-datalake
  â”œâ”€â”€ raw/                                    [Bronze Layer - ì›ì‹œ ë°ì´í„°]
  â”‚   â”œâ”€â”€ app-events/                         â† ì•± ì´ë²¤íŠ¸ ë¡œê·¸
  â”‚   â”‚   â”œâ”€â”€ dt=2024-01-15/
  â”‚   â”‚   â”‚   â”œâ”€â”€ hour=00/
  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ events_0000.json.gz     (Kafka Consumer ì¶œë ¥)
  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ events_0001.json.gz
  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ events_0002.json.gz
  â”‚   â”‚   â”‚   â”œâ”€â”€ hour=01/
  â”‚   â”‚   â”‚   â””â”€â”€ hour=23/
  â”‚   â”‚   â””â”€â”€ dt=2024-01-16/
  â”‚   â”‚
  â”‚   â”œâ”€â”€ crash-reports/                      â† í¬ë˜ì‹œ ë¦¬í¬íŠ¸
  â”‚   â”‚   â””â”€â”€ dt=2024-01-15/
  â”‚   â”‚       â””â”€â”€ crash_ios_001.json
  â”‚   â”‚
  â”‚   â””â”€â”€ server-logs/                        â† API ì„œë²„ ë¡œê·¸
  â”‚       â””â”€â”€ dt=2024-01-15/
  â”‚
  â”œâ”€â”€ processed/                              [Silver Layer - ì •ì œ ë°ì´í„°]
  â”‚   â”œâ”€â”€ events/                             â† ETL í›„ Parquet ë³€í™˜
  â”‚   â”‚   â”œâ”€â”€ dt=2024-01-15/
  â”‚   â”‚   â”‚   â”œâ”€â”€ part-00000-xxx.snappy.parquet
  â”‚   â”‚   â”‚   â”œâ”€â”€ part-00001-xxx.snappy.parquet
  â”‚   â”‚   â”‚   â””â”€â”€ _SUCCESS
  â”‚   â”‚   â””â”€â”€ _delta_log/                     â† Delta Lake ì‚¬ìš© ì‹œ
  â”‚   â”‚
  â”‚   â””â”€â”€ users/                              â† ì‚¬ìš©ì ë§ˆìŠ¤í„° ë°ì´í„°
  â”‚       â””â”€â”€ snapshot_2024-01-15.parquet
  â”‚
  â”œâ”€â”€ curated/                                [Gold Layer - ë¶„ì„ìš© ë°ì´í„°]
  â”‚   â”œâ”€â”€ daily_metrics/                      â† ì¼ë³„ KPI ì§‘ê³„
  â”‚   â”‚   â””â”€â”€ dt=2024-01-15/
  â”‚   â”‚       â””â”€â”€ metrics.parquet
  â”‚   â”‚
  â”‚   â”œâ”€â”€ user_segments/                      â† ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸
  â”‚   â”‚   â””â”€â”€ segment_2024-01-15.parquet
  â”‚   â”‚
  â”‚   â””â”€â”€ funnel_analysis/                    â† í¼ë„ ë¶„ì„ ê²°ê³¼
  â”‚
  â””â”€â”€ archive/                                [Cold Storage - ì•„ì¹´ì´ë¸Œ]
      â””â”€â”€ 2023/                               â† Glacierë¡œ ì „í™˜ëœ ë°ì´í„°
          â””â”€â”€ app-events/

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  íŒŒì¼ ë„¤ì´ë° ì»¨ë²¤ì…˜                                                       â”‚
  â”‚                                                                          â”‚
  â”‚  raw:       {source}_{timestamp}_{sequence}.json.gz                     â”‚
  â”‚  processed: part-{partition}-{uuid}.snappy.parquet                      â”‚
  â”‚  curated:   {metric_name}_{date}.parquet                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ëª¨ë°”ì¼ ì•± ì´ë¯¸ì§€/ë¯¸ë””ì–´ ì €ì¥ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì‚¬ìš©ì ì—…ë¡œë“œ ë¯¸ë””ì–´ ì €ì¥ êµ¬ì¡°                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  S3 Bucket: company-user-media
  â”œâ”€â”€ uploads/                                [ì›ë³¸ ì—…ë¡œë“œ]
  â”‚   â”œâ”€â”€ profile-images/
  â”‚   â”‚   â””â”€â”€ {user_id}/
  â”‚   â”‚       â””â”€â”€ {uuid}.jpg                  â† ì›ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€
  â”‚   â”‚
  â”‚   â””â”€â”€ posts/
  â”‚       â””â”€â”€ {post_id}/
  â”‚           â”œâ”€â”€ image_001.jpg
  â”‚           â””â”€â”€ video_001.mp4
  â”‚
  â”œâ”€â”€ processed/                              [ì²˜ë¦¬ëœ ë¯¸ë””ì–´]
  â”‚   â”œâ”€â”€ profile-images/
  â”‚   â”‚   â””â”€â”€ {user_id}/
  â”‚   â”‚       â”œâ”€â”€ {uuid}_thumb.jpg            â† 100x100 ì¸ë„¤ì¼
  â”‚   â”‚       â”œâ”€â”€ {uuid}_medium.jpg           â† 300x300 ì¤‘ê°„
  â”‚   â”‚       â””â”€â”€ {uuid}_large.jpg            â† ì›ë³¸ í¬ê¸°
  â”‚   â”‚
  â”‚   â””â”€â”€ posts/
  â”‚       â””â”€â”€ {post_id}/
  â”‚           â”œâ”€â”€ image_001_thumb.webp        â† WebP ë³€í™˜
  â”‚           â””â”€â”€ video_001_hls/              â† HLS ìŠ¤íŠ¸ë¦¬ë°ìš©
  â”‚               â”œâ”€â”€ playlist.m3u8
  â”‚               â””â”€â”€ segment_001.ts
  â”‚
  â””â”€â”€ temp/                                   [ì„ì‹œ íŒŒì¼ - 24ì‹œê°„ í›„ ì‚­ì œ]
      â””â”€â”€ upload_sessions/

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  CloudFront ì—°ë™                                                         â”‚
  â”‚                                                                          â”‚
  â”‚  https://cdn.company.com/profile-images/{user_id}/{uuid}_thumb.jpg     â”‚
  â”‚                    â†“                                                     â”‚
  â”‚  CloudFront â†’ S3 (processed/profile-images/...)                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ì‹¤ë¬´ì—ì„œ ìì£¼ ê²ªëŠ” S3 ë¬¸ì œì™€ í•´ê²°ì±…

### ë¬¸ì œ 1: S3 ì ‘ê·¼ ê¶Œí•œ ì˜¤ë¥˜

| ì¦ìƒ | ì›ì¸ | í•´ê²°ì±… |
|------|------|--------|
| AccessDenied ì—ëŸ¬ | IAM ì •ì±… ëˆ„ë½ | s3:GetObject, s3:ListBucket ê¶Œí•œ ì¶”ê°€ |
| íŠ¹ì • í”„ë¦¬í”½ìŠ¤ë§Œ ì ‘ê·¼ ë¶ˆê°€ | ë²„í‚· ì •ì±… ì œí•œ | Resource ARNì— í•´ë‹¹ í”„ë¦¬í”½ìŠ¤ í¬í•¨ |
| Cross-account ì ‘ê·¼ ë¶ˆê°€ | ë²„í‚· ì •ì±… ë¯¸ì„¤ì • | ë²„í‚· ì •ì±…ì— íƒ€ ê³„ì • Principal ì¶”ê°€ |

```json
// IAM ì •ì±… ì˜ˆì‹œ - íŠ¹ì • í”„ë¦¬í”½ìŠ¤ë§Œ ì ‘ê·¼ í—ˆìš©
{
    "Version": "2012-10-17",
    "Statement": [{
        "Effect": "Allow",
        "Action": ["s3:GetObject", "s3:ListBucket"],
        "Resource": [
            "arn:aws:s3:::data-lake",
            "arn:aws:s3:::data-lake/processed/*"  // processed/ ë§Œ ì ‘ê·¼
        ],
        "Condition": {
            "StringLike": {"s3:prefix": ["processed/*"]}
        }
    }]
}
```

### ë¬¸ì œ 2: ëŠë¦° S3 ì½ê¸° ì„±ëŠ¥

| ì¦ìƒ | ì›ì¸ | í•´ê²°ì±… |
|------|------|--------|
| Spark ì‘ì—…ì´ ëŠë¦¼ | ì‘ì€ íŒŒì¼ ë‹¤ìˆ˜ | íŒŒì¼ ë³‘í•©(Compaction) |
| LIST ìš”ì²­ íƒ€ì„ì•„ì›ƒ | íŒŒí‹°ì…˜ì— íŒŒì¼ 100ë§Œê°œ+ | í”„ë¦¬í”½ìŠ¤ êµ¬ì¡° ê°œì„  |
| ì²˜ë¦¬ëŸ‰ ì œí•œ | ë‹¨ì¼ í”„ë¦¬í”½ìŠ¤ì— ì§‘ì¤‘ | í”„ë¦¬í”½ìŠ¤ ë¶„ì‚° (í•´ì‹œ ì‚¬ìš©) |

```python
# í”„ë¦¬í”½ìŠ¤ ë¶„ì‚°ìœ¼ë¡œ ì²˜ë¦¬ëŸ‰ í–¥ìƒ
# AS-IS: s3://bucket/logs/2024-01-15/file1.json (ë‹¨ì¼ í”„ë¦¬í”½ìŠ¤)
# TO-BE: s3://bucket/logs/hash=a/2024-01-15/file1.json (ë¶„ì‚° í”„ë¦¬í”½ìŠ¤)

import hashlib

def get_distributed_prefix(user_id: str, date: str) -> str:
    hash_prefix = hashlib.md5(user_id.encode()).hexdigest()[:2]
    return f"logs/hash={hash_prefix}/dt={date}/"

# ê²°ê³¼: logs/hash=3f/dt=2024-01-15/
# 256ê°œ í”„ë¦¬í”½ìŠ¤ë¡œ ë¶„ì‚° â†’ ì²˜ë¦¬ëŸ‰ 256ë°° í–¥ìƒ
```

### ë¬¸ì œ 3: ì˜ˆìƒì¹˜ ëª»í•œ ë¹„ìš© ê¸‰ì¦

| ì¦ìƒ | ì›ì¸ | í•´ê²°ì±… |
|------|------|--------|
| GET ìš”ì²­ ë¹„ìš© í­ì¦ | ë¬´í•œ ë£¨í”„ Lambda | S3 ì´ë²¤íŠ¸ í•„í„°ë§, ì†ŒìŠ¤/ëŒ€ìƒ ë²„í‚· ë¶„ë¦¬ |
| ìŠ¤í† ë¦¬ì§€ ë¹„ìš© ê¸‰ì¦ | ë²„ì „ ëˆ„ì , ì„ì‹œ íŒŒì¼ | ë¼ì´í”„ì‚¬ì´í´ ì •ì±…ìœ¼ë¡œ ìë™ ì‚­ì œ |
| ì „ì†¡ ë¹„ìš© ê¸‰ì¦ | Cross-region ì „ì†¡ | ê°™ì€ ë¦¬ì „ì— ì²˜ë¦¬ ë¦¬ì†ŒìŠ¤ ë°°ì¹˜ |

```json
// ë¹„ìš© ì ˆê°ì„ ìœ„í•œ ë¼ì´í”„ì‚¬ì´í´ ì •ì±…
{
    "Rules": [
        {
            "ID": "DeleteTempFiles",
            "Filter": {"Prefix": "temp/"},
            "Status": "Enabled",
            "Expiration": {"Days": 1}
        },
        {
            "ID": "CleanupOldVersions",
            "Filter": {"Prefix": ""},
            "Status": "Enabled",
            "NoncurrentVersionExpiration": {"NoncurrentDays": 30}
        },
        {
            "ID": "ArchiveOldRawLogs",
            "Filter": {"Prefix": "raw/"},
            "Status": "Enabled",
            "Transitions": [
                {"Days": 30, "StorageClass": "STANDARD_IA"},
                {"Days": 90, "StorageClass": "GLACIER"}
            ]
        }
    ]
}
```

---

## ì°¸ê³  ìë£Œ

- [AWS S3 ê³µì‹ ë¬¸ì„œ](https://docs.aws.amazon.com/s3/)
- [S3 ëª¨ë²” ì‚¬ë¡€](https://docs.aws.amazon.com/AmazonS3/latest/userguide/optimizing-performance.html)
- [ë°ì´í„° ë ˆì´í¬ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ](https://aws.amazon.com/big-data/datalakes-and-analytics/data-lake-house/)
- [Delta Lake - ì˜¤í”ˆì†ŒìŠ¤ í…Œì´ë¸” í¬ë§·](https://delta.io/)
- [Apache Iceberg - í…Œì´ë¸” í¬ë§·](https://iceberg.apache.org/)
