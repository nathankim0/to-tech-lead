# Level 5: 아키텍처 설계

## 학습 목표

이 레벨을 완료하면 다음을 할 수 있습니다:

- **대규모 서비스 설계**: 수백만 사용자를 처리할 수 있는 확장 가능한 시스템 아키텍처 설계
- **장애 대응 전략 수립**: 시스템 장애 시나리오 예측 및 대응 방안 수립
- **기술 의사결정**: 비즈니스 요구사항에 맞는 아키텍처 패턴 선택 및 적용
- **팀 리딩**: 아키텍처 설계 문서화 및 팀원과의 기술 커뮤니케이션

---

## 학습 내용

| 순서 | 주제 | 설명 | 난이도 |
|:---:|:---|:---|:---:|
| 1 | [Clean Architecture](./01-clean-architecture.md) | 의존성 규칙과 계층 분리를 통한 유지보수 가능한 설계 | 중 |
| 2 | [Microservice](./02-microservice.md) | 독립적으로 배포 가능한 서비스 단위로 시스템 분리 | 상 |
| 3 | [Event Driven](./03-event-driven.md) | 이벤트 기반의 느슨한 결합 아키텍처 | 상 |
| 4 | [CQRS](./04-cqrs.md) | 명령과 조회의 책임 분리 패턴 | 상 |
| 5 | [장애 대응 전략](./05-failure-response.md) | 시스템 장애 예방 및 대응 방안 | 중 |

---

## 아키텍처 패턴 간의 관계

아래 패턴들은 상호 배타적이 아니라 **상호 보완적**입니다. 실무에서는 여러 패턴을 조합하여 사용합니다.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         아키텍처 패턴 관계도                                  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        모바일 앱 / 웹 클라이언트                       │   │
│  └───────────────────────────────┬─────────────────────────────────────┘   │
│                                  │                                          │
│                                  ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          Clean Architecture                          │   │
│  │                     (앱 내부 레이어 분리)                             │   │
│  │           Presentation → Domain → Data                              │   │
│  └───────────────────────────────┬─────────────────────────────────────┘   │
│                                  │ API 호출                                 │
│                                  ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          Microservices                               │   │
│  │                    (독립적인 서비스들의 집합)                          │   │
│  │  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐             │   │
│  │  │ User    │   │ Order   │   │ Payment │   │ Search  │             │   │
│  │  │ Service │   │ Service │   │ Service │   │ Service │             │   │
│  │  └────┬────┘   └────┬────┘   └────┬────┘   └────┬────┘             │   │
│  │       │             │             │             │                   │   │
│  └───────┼─────────────┼─────────────┼─────────────┼───────────────────┘   │
│          │             │             │             │                        │
│          │             ▼             │             │                        │
│  ┌───────┼────────────────────────────┼────────────┼───────────────────┐   │
│  │       │         Event Driven       │            │                   │   │
│  │       │       (비동기 통신)         │            │                   │   │
│  │       │     ┌────────────────┐     │            │                   │   │
│  │       └────►│  Message Bus   │◄────┘            │                   │   │
│  │             │   (Kafka)      │◄──────────────────┘                   │   │
│  │             └───────┬────────┘                                       │   │
│  │                     │                                                │   │
│  └─────────────────────┼────────────────────────────────────────────────┘   │
│                        │                                                    │
│                        ▼                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                            CQRS                                      │   │
│  │                  (읽기/쓰기 모델 분리)                                │   │
│  │   ┌──────────────┐              ┌──────────────┐                    │   │
│  │   │ Write Model  │───이벤트────►│  Read Model  │                    │   │
│  │   │ (PostgreSQL) │              │(Elasticsearch)│                   │   │
│  │   └──────────────┘              └──────────────┘                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│                 ↑↓ 모든 레이어에서 장애 대응 전략 적용 ↑↓                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        장애 대응 전략                                 │   │
│  │    Circuit Breaker | Retry | Fallback | Monitoring | Alerting       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 패턴별 주요 적용 범위

| 패턴 | 적용 범위 | 관련 패턴 |
|:---|:---|:---|
| **Clean Architecture** | 개별 앱/서비스 내부 구조 | MVVM, MVI, DI |
| **Microservices** | 전체 시스템의 서비스 분리 | Event Driven, CQRS |
| **Event Driven** | 서비스 간 비동기 통신 | Microservices, CQRS, Saga |
| **CQRS** | 데이터 읽기/쓰기 최적화 | Event Driven, Event Sourcing |
| **장애 대응** | 모든 레이어 | Circuit Breaker, Bulkhead |

---

## 아키텍처 선택 가이드라인

### 상황별 패턴 선택 의사결정 트리

```
시작: 어떤 아키텍처 패턴이 필요한가?
│
├── 앱/서비스 내부 구조가 복잡한가?
│   └── Yes ──► Clean Architecture
│              (테스트 용이성, 유지보수성 향상)
│
├── 서비스가 너무 커서 배포가 두려운가?
│   └── Yes ──► Microservices 검토
│              단, 팀 규모 10명 이상 권장
│
├── 서비스 간 강한 결합이 문제인가?
│   └── Yes ──► Event Driven Architecture
│              (비동기 통신으로 결합도 낮춤)
│
├── 읽기 트래픽이 쓰기의 10배 이상인가?
│   └── Yes ──► CQRS
│              (읽기 모델 별도 최적화)
│
└── 장애가 자주 발생하거나 영향이 큰가?
    └── Yes ──► 장애 대응 전략 강화
               (모니터링, 알람, 페일오버)
```

### 팀 규모와 서비스 성숙도에 따른 권장 패턴

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      팀 규모 / 서비스 성숙도 매트릭스                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  서비스 규모                                                                 │
│       ▲                                                                     │
│       │                                                                     │
│  대규모 │                     ┌─────────────────────┐                       │
│ (100만+ │                     │   Full Microservices│                       │
│   DAU) │                     │   + Event Driven    │                       │
│       │                     │   + CQRS            │                       │
│       │                     └─────────────────────┘                       │
│       │                               ▲                                    │
│       │          ┌────────────────────┴────────────────────┐              │
│  중규모 │          │    Modular Monolith                    │              │
│ (10만  │          │    + Event Driven (일부)               │              │
│   DAU) │          │    + 핵심 서비스만 분리                 │              │
│       │          └─────────────────────────────────────────┘              │
│       │                    ▲                                               │
│       │   ┌────────────────┴────────────────────┐                         │
│  소규모 │   │    Monolith                        │                         │
│ (1만   │   │    + Clean Architecture           │                         │
│   DAU) │   │    + 기본 장애 대응                │                         │
│       │   └─────────────────────────────────────┘                         │
│       │                                                                    │
│       └──────────────────────────────────────────────────────────►        │
│              1-5명        5-20명        20-50명        50명+               │
│                                팀 규모                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 실제 서비스 사례로 보는 아키텍처 진화

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Netflix 아키텍처 진화                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  2007년 (스타트업)                                                          │
│  ────────────────                                                           │
│  ┌─────────────┐                                                           │
│  │  Monolith   │  DVD 배송 서비스                                          │
│  │  (Oracle)   │  단일 데이터센터                                          │
│  └─────────────┘                                                           │
│                                                                             │
│  2010년 (성장기) - 대규모 장애 후                                            │
│  ───────────────────────────                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │                    AWS 마이그레이션                    │                 │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐    │                 │
│  │  │API 서비스│ │스트리밍 │ │추천     │ │과금     │    │                 │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘    │                 │
│  │              초기 서비스 분리                         │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                                                                             │
│  2015년 (성숙기)                                                            │
│  ──────────────                                                             │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │            700+ Microservices                         │                 │
│  │    ┌─────────────────────────────────────────────┐   │                 │
│  │    │              Kafka Event Bus                │   │                 │
│  │    └─────────────────────────────────────────────┘   │                 │
│  │    Circuit Breaker (Hystrix)                         │                 │
│  │    Chaos Engineering (Simian Army)                   │                 │
│  │    Multi-region Active-Active                        │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                                                                             │
│  교훈: 모놀리식에서 시작 → 문제가 생기는 부분부터 점진적 분리                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 한국 서비스 사례

| 서비스 | 아키텍처 특징 | 주요 기술 |
|:---|:---|:---|
| **배달의민족** | Microservices + Event Driven | Kafka, Kubernetes, Spring Boot |
| **쿠팡** | CQRS (검색/상품), 멀티 리전 | Elasticsearch, Redis, AWS |
| **토스** | Event Sourcing, Clean Architecture | Kotlin, Kafka, PostgreSQL |
| **카카오** | Microservices, Multi-cluster | Kubernetes, Kafka, gRPC |
| **당근마켓** | Modular Monolith → Microservices 진행 중 | Ruby → Kotlin/Go 전환 |

---

## 왜 아키텍처 설계가 중요한가?

모바일 개발자로서 앱 하나를 만드는 것과, 테크리드로서 전체 시스템을 설계하는 것은 완전히 다른 차원의 문제입니다.

```
개발자 관점                    테크리드 관점
┌─────────────┐               ┌─────────────────────────────────┐
│   앱 개발    │               │  시스템 전체 아키텍처 설계         │
│  - UI/UX    │               │  - 서비스 간 통신                 │
│  - API 연동  │      →        │  - 데이터 일관성                  │
│  - 로컬 저장 │               │  - 확장성/가용성                  │
└─────────────┘               │  - 장애 대응                     │
                              └─────────────────────────────────┘
```

아키텍처 설계 능력은:
- 복잡한 비즈니스 요구사항을 기술적으로 해결하는 능력
- 팀원들과 기술적 비전을 공유하는 커뮤니케이션 능력
- 미래의 변화에 대응할 수 있는 유연한 시스템을 만드는 능력

을 의미합니다.

---

## AI 학습 프롬프트 예시

아래 프롬프트를 활용하여 AI와 함께 깊이 있는 학습을 진행하세요.

### CTO 역할 프롬프트

```
당신은 유니콘 스타트업의 CTO입니다.
저는 시니어 모바일 개발자이며, 백엔드 아키텍처 설계에 대해 배우고 싶습니다.

다음 상황에서 어떤 아키텍처를 선택해야 할지 조언해주세요:

[상황 설명]
- 현재 사용자: 10만 DAU
- 목표: 1년 내 100만 DAU
- 주요 기능: 실시간 채팅, 피드, 결제
- 팀 규모: 백엔드 5명, 모바일 3명

[질문]
1. 모놀리식에서 마이크로서비스로 전환해야 할까요?
2. 전환한다면 어떤 서비스부터 분리해야 할까요?
3. 모바일 개발자로서 백엔드 아키텍처 변경 시 주의할 점은?
```

### 장애 대응 시뮬레이션 프롬프트

```
당신은 대규모 서비스 운영 경험이 풍부한 SRE 엔지니어입니다.

다음 장애 상황을 시뮬레이션하고, 대응 방안을 함께 논의해주세요:

[장애 상황]
- 서비스: 이커머스 앱
- 증상: 결제 API 응답 시간 10초 이상, 에러율 30%
- 영향: 매출 손실 분당 1000만원

[질문]
1. 즉각적인 대응 방안은?
2. 근본 원인을 찾기 위한 진단 절차는?
3. 재발 방지를 위한 아키텍처 개선안은?
```

### 아키텍처 리뷰 프롬프트

```
당신은 10년차 백엔드 아키텍트입니다.

제가 설계한 아키텍처를 리뷰해주세요:

[시스템 개요]
(여기에 본인이 설계한 아키텍처 설명)

[주요 고려사항]
- 확장성
- 가용성
- 데이터 일관성

[질문]
1. 이 설계의 장단점은?
2. 놓친 부분이나 개선할 점은?
3. 비슷한 서비스의 실제 사례는?
```

---

## 산출물

이 레벨을 완료하며 다음 산출물을 작성해보세요.

### 1. 서비스 아키텍처 문서

가상의 서비스 또는 실제 프로젝트에 대한 아키텍처 설계 문서를 작성합니다.

```markdown
# [서비스명] 아키텍처 설계 문서

## 1. 개요
- 서비스 소개
- 비즈니스 요구사항
- 기술적 제약사항

## 2. 시스템 아키텍처
- 전체 구조 다이어그램
- 서비스 간 통신 방식
- 데이터 흐름

## 3. 주요 컴포넌트
- 각 서비스 역할과 책임
- 기술 스택 선택 이유

## 4. 비기능 요구사항
- 확장성 전략
- 가용성 목표 (SLA)
- 보안 고려사항

## 5. 리스크 및 대응 방안
- 예상되는 기술적 리스크
- 각 리스크에 대한 대응 방안
```

### 2. 장애 대응 시나리오

주요 장애 유형별 대응 시나리오를 작성합니다.

```markdown
# [서비스명] 장애 대응 시나리오

## 시나리오 1: 데이터베이스 장애

### 증상
- API 응답 시간 급증
- 에러 로그 다량 발생

### 즉각 대응
1. 장애 공지 발송 (5분 이내)
2. 읽기 트래픽 레플리카로 전환
3. ...

### 근본 원인 분석
- 로그 분석
- 메트릭 확인
- ...

### 재발 방지
- 모니터링 강화
- 자동 페일오버 설정
- ...
```

---

## 학습 팁

1. **실제 사례 연구**: AWS, Netflix, Uber 등 대규모 서비스의 기술 블로그를 읽어보세요
2. **직접 설계해보기**: 이론만 아는 것과 직접 설계해보는 것은 다릅니다
3. **트레이드오프 이해**: 모든 아키텍처는 장단점이 있습니다. 상황에 맞는 선택이 중요합니다
4. **점진적 개선**: 처음부터 완벽한 아키텍처는 없습니다. 작게 시작해서 개선해나가세요

---

## 다음 단계

Level 5를 완료했다면:
- 실제 프로젝트에 학습한 아키텍처 패턴 적용해보기
- 팀 내 아키텍처 리뷰 문화 만들기
- 기술 블로그 작성으로 지식 공유하기
